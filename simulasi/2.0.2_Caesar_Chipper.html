<!-- caesar_cipher_learning.html -->
<!DOCTYPE html>
<html lang="id" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Pembelajaran Caesar Cipher</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc;
            /* Light Gray background */
        }

        .tab-btn.active {
            border-color: #4f46e5;
            color: #4f46e5;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
        
        /* Custom CSS for input fields to ensure visibility and height */
        .input-field {
            width: 100%;
            text-align: center;
            font-size: 1.25rem;
            text-transform: uppercase;
            background-color: #ffffff;
            border-radius: 0.75rem;
            transition: all 0.2s ease-in-out;
            border-width: 2px;
            border-style: solid;
            border-color: #cbd5e1; /* slate-300 */
            padding: 1.2rem 1rem;
        }

        .input-field:focus {
            outline: none;
            border-color: #6366f1; /* indigo-500 */
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3);
        }

    </style>
</head>

<body class="text-slate-700">

    <div class="container mx-auto max-w-5xl px-4 py-8">

        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900">Belajar Kriptografi: Caesar Cipher</h1>
            <p class="mt-3 text-lg text-slate-500">Pahami salah satu teknik enkripsi tertua dengan cara yang modern dan interaktif.</p>
        </header>

        <!-- Tab Navigation -->
        <div class="mb-8 border-b border-gray-200">
            <nav class="flex justify-center -mb-px space-x-6" aria-label="Tabs">
                <button class="tab-btn active whitespace-nowrap py-4 px-1 border-b-2 font-semibold text-lg"
                    data-tab="konsep">Konsep</button>
                <button class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-semibold text-lg text-gray-500 hover:text-indigo-600"
                    data-tab="contoh">Contoh Soal</button>
                <button class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-semibold text-lg text-gray-500 hover:text-indigo-600"
                    data-tab="latihan">Latihan Soal</button>
                <button class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-semibold text-lg text-gray-500 hover:text-indigo-600"
                    data-tab="kuis">Kuis Gamifikasi</button>
            </nav>
        </div>

        <!-- Tab Content -->
        <div>
            <!-- Konsep Section -->
            <div id="konsep" class="tab-content active space-y-8">
                <div class="bg-white p-8 rounded-2xl shadow-sm">
                    <h2 class="text-2xl font-bold text-slate-800 mb-4">Apa itu Caesar Cipher?</h2>
                    <p class="leading-relaxed text-slate-600">
                        Caesar Cipher adalah salah satu teknik enkripsi paling awal dan paling sederhana yang pernah
                        tercatat. Dalam metode ini, setiap huruf dalam teks asli (plaintext) digeser sejumlah posisi
                        tertentu ke bawah dalam urutan alfabet untuk menghasilkan teks sandi (ciphertext). Misalnya,
                        dengan pergeseran (kunci) sebesar 3, huruf 'A' akan menjadi 'D', 'B' menjadi 'E', dan seterusnya.
                    </p>
                </div>
                
                 <div class="bg-white p-8 rounded-2xl shadow-sm">
                    <h2 class="text-2xl font-bold text-slate-800 mb-2">Sejarah Singkat</h2>
                    <p class="leading-relaxed text-slate-600 mb-4">
                        Nama "Caesar Cipher" diambil dari nama <strong class="font-semibold">Julius Caesar</strong>, seorang jenderal dan negarawan Romawi yang menggunakan metode ini untuk melindungi komunikasi militernya. Ia menggunakan pergeseran sebesar 3 untuk mengenkripsi pesan-pesan penting yang dikirimkan kepada para jenderalnya di medan perang. Jika ada pesan yang berhasil direbut oleh musuh, mereka tidak akan bisa memahaminya tanpa mengetahui kuncinya.
                    </p>
                     <h2 class="text-2xl font-bold text-slate-800 mb-2 mt-6">Kelemahan Caesar Cipher</h2>
                     <p class="leading-relaxed text-slate-600">
                        Meskipun efektif pada masanya, Caesar Cipher sangat mudah dipecahkan dengan teknik modern. Kelemahan utamanya adalah hanya ada 25 kemungkinan kunci (untuk alfabet A-Z). Metode pemecahannya yang paling umum adalah <strong class="font-semibold">Analisis Frekuensi</strong>, yaitu dengan menganalisis huruf mana yang paling sering muncul dalam ciphertext dan mencocokkannya dengan huruf yang paling sering digunakan dalam suatu bahasa (misalnya, huruf 'E' dalam bahasa Inggris atau 'A' dalam bahasa Indonesia).
                    </p>
                </div>

                <div class="bg-white p-8 rounded-2xl shadow-sm">
                    <h2 class="text-2xl font-bold text-slate-800 mb-6">Visualisasi Pergeseran Alfabet</h2>
                    <div class="text-center mb-6">
                        <label for="key-slider" class="block font-semibold mb-2">Kunci Pergeseran: <span
                                id="slider-value" class="text-indigo-600 font-bold text-2xl">3</span></label>
                        <input type="range" id="key-slider" min="1" max="25" value="3"
                            class="w-full max-w-md mx-auto">
                    </div>
                    <div class="font-mono text-lg md:text-xl break-words text-center leading-loose">
                        <p id="alphabet-plain" class="text-slate-500">A B C D E F G H I J K L M N O P Q R S T U V W X Y
                            Z</p>
                        <p id="alphabet-arrow" class="text-indigo-500 font-bold">↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓ ↓
                            ↓</p>
                        <p id="alphabet-cipher" class="text-slate-900 font-bold">D E F G H I J K L M N O P Q R S T U V W X Y Z A
                            B C</p>
                    </div>
                </div>
            </div>

            <!-- Contoh Soal Section -->
            <div id="contoh" class="tab-content">
                 <div class="bg-white p-8 rounded-2xl shadow-sm space-y-8">
                    <!-- Contoh Enkripsi -->
                    <div>
                        <h3 class="text-xl font-bold mb-3">Contoh 1: Enkripsi</h3>
                        <div class="bg-slate-50 p-6 rounded-lg">
                            <p><strong>Plaintext:</strong> Kripto</p>
                            <p><strong>Kunci:</strong> 5</p>
                            <p><strong>Pertanyaan:</strong> Apakah ciphertext-nya?</p>
                        </div>
                        <button class="toggle-pembahasan mt-4 bg-indigo-100 text-indigo-700 font-semibold px-4 py-2 rounded-md hover:bg-indigo-200">Tampilkan Pembahasan</button>
                        <div class="pembahasan-container hidden mt-4 border-t pt-4">
                           <!-- Pembahasan Enkripsi akan di-generate oleh JS -->
                        </div>
                    </div>
                     <!-- Contoh Dekripsi -->
                    <div>
                        <h3 class="text-xl font-bold mb-3">Contoh 2: Dekripsi</h3>
                        <div class="bg-slate-50 p-6 rounded-lg">
                            <p><strong>Ciphertext:</strong> FUBSWH</p>
                            <p><strong>Kunci:</strong> 8</p>
                            <p><strong>Pertanyaan:</strong> Apakah plaintext-nya?</p>
                        </div>
                         <button class="toggle-pembahasan mt-4 bg-indigo-100 text-indigo-700 font-semibold px-4 py-2 rounded-md hover:bg-indigo-200">Tampilkan Pembahasan</button>
                        <div class="pembahasan-container hidden mt-4 border-t pt-4">
                           <!-- Pembahasan Dekripsi akan di-generate oleh JS -->
                        </div>
                    </div>
                     <!-- Contoh Cari Kunci -->
                     <div>
                        <h3 class="text-xl font-bold mb-3">Contoh 3: Mencari Kunci</h3>
                        <div class="bg-slate-50 p-6 rounded-lg">
                            <p><strong>Plaintext:</strong> SANDI</p>
                            <p><strong>Ciphertext:</strong> XERHM</p>
                            <p><strong>Pertanyaan:</strong> Berapakah kuncinya?</p>
                        </div>
                         <button class="toggle-pembahasan mt-4 bg-indigo-100 text-indigo-700 font-semibold px-4 py-2 rounded-md hover:bg-indigo-200">Tampilkan Pembahasan</button>
                        <div class="pembahasan-container hidden mt-4 border-t pt-4">
                           <!-- Pembahasan Cari Kunci akan di-generate oleh JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Latihan Soal Section -->
            <div id="latihan" class="tab-content">
                <div class="bg-white p-8 rounded-2xl shadow-sm text-center">
                    <h2 class="text-2xl font-bold mb-2 text-slate-800">Pilih Mode Latihan</h2>
                    <p class="text-slate-500 mb-8">Asah kemampuanmu dengan menyelesaikan soal-soal berikut.</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-3xl mx-auto">
                        <button data-mode="encrypt" class="latihan-mode-btn bg-white border-2 border-slate-200 p-6 rounded-lg font-semibold text-slate-700 hover:border-green-400 hover:text-green-600 transition-all duration-200">
                            Mode Enkripsi
                        </button>
                        <button data-mode="decrypt" class="latihan-mode-btn bg-white border-2 border-slate-200 p-6 rounded-lg font-semibold text-slate-700 hover:border-orange-400 hover:text-orange-600 transition-all duration-200">
                            Mode Dekripsi
                        </button>
                        <button data-mode="find-key" class="latihan-mode-btn bg-white border-2 border-slate-200 p-6 rounded-lg font-semibold text-slate-700 hover:border-purple-400 hover:text-purple-600 transition-all duration-200">
                            Cari Kunci
                        </button>
                    </div>
                </div>
            </div>

            <!-- Kuis Section -->
            <div id="kuis" class="tab-content">
                 <div class="bg-white p-8 rounded-2xl shadow-sm text-center">
                     <h2 class="text-3xl font-bold text-slate-800 mb-2">Kuis Gamifikasi</h2>
                     <p class="text-slate-500 mb-6">Uji pemahamanmu dalam mode kuis yang seru!</p>
                     <div class="mb-6">
                        <span class="font-semibold">Skor Tertinggi:</span>
                        <span id="highscore-display" class="font-bold text-2xl text-indigo-600">0</span>
                     </div>
                     <button id="start-quiz-btn" class="bg-indigo-600 text-white font-bold py-3 px-10 rounded-full text-lg hover:bg-indigo-700 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                        Mulai Kuis!
                     </button>
                 </div>
            </div>
        </div>
    </div>
    
    <!-- Latihan Modal -->
    <div id="latihan-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 hidden">
        <div id="latihan-modal-content" class="bg-white rounded-2xl shadow-2xl w-full max-w-lg p-8 relative transform transition-all duration-300 scale-95 opacity-0">
            <button id="close-latihan-modal" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 id="latihan-title" class="text-3xl font-bold text-center mb-6">Mode Latihan</h2>
            
            <!-- Latihan Content -->
            <div id="latihan-question-encrypt" class="hidden">
                 <div class="bg-slate-50 p-6 rounded-lg mb-6 text-center">
                    <p class="text-slate-500">Plaintext (Kata Asli):</p>
                    <p id="latihan-encrypt-plaintext" class="text-3xl font-bold text-slate-800 tracking-widest">KODE</p>
                    <p class="text-slate-500 mt-4">Kunci (Jumlah Pergeseran):</p>
                    <p id="latihan-encrypt-key" class="text-3xl font-bold text-slate-800">5</p>
                </div>
                <label for="latihan-encrypt-input" class="block text-left mb-2 text-slate-600">Ketik Hasil Enkripsi Anda di Sini:</label>
            </div>
             <div id="latihan-question-decrypt" class="hidden">
                 <div class="bg-slate-50 p-6 rounded-lg mb-6 text-center">
                    <p class="text-slate-500">Ciphertext (Kata Sandi):</p>
                    <p id="latihan-decrypt-ciphertext" class="text-3xl font-bold text-slate-800 tracking-widest">PBFI</p>
                    <p class="text-slate-500 mt-4">Kunci (Jumlah Pergeseran):</p>
                    <p id="latihan-decrypt-key" class="text-3xl font-bold text-slate-800">10</p>
                </div>
                <label for="latihan-decrypt-input" class="block text-left mb-2 text-slate-600">Ketik Hasil Dekripsi Anda di Sini:</label>
            </div>
             <div id="latihan-question-find-key" class="hidden">
                 <div class="bg-slate-50 p-6 rounded-lg mb-6 text-center">
                    <p class="text-slate-500">Plaintext (Kata Asli):</p>
                    <p id="latihan-find-key-plaintext" class="text-3xl font-bold text-slate-800 tracking-widest">AMAN</p>
                    <p class="text-slate-500 mt-4">Ciphertext (Kata Sandi):</p>
                    <p id="latihan-find-key-ciphertext" class="text-3xl font-bold text-slate-800 tracking-widest">FRET</p>
                </div>
                <label for="latihan-find-key-input" class="block text-left mb-2 text-slate-600">Berapa Kunci Pergeserannya?</label>
            </div>
            
            <input type="text" id="latihan-input" class="input-field mb-4">
            
            <div id="latihan-feedback" class="text-center font-bold mb-4 hidden h-6"></div>
            
            <div class="flex items-center justify-center space-x-4">
                 <button id="latihan-skip-btn" class="bg-slate-200 text-slate-700 font-bold py-3 px-6 rounded-lg hover:bg-slate-300 transition-colors">Lewati</button>
                <button id="latihan-submit-btn" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg text-lg hover:bg-green-700 transition-all w-40">Jawab</button>
                <button id="latihan-next-btn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg text-lg hover:bg-indigo-700 transition-all w-40 hidden">Soal Berikutnya</button>
            </div>
        </div>
    </div>
    
    <!-- Kuis Modal -->
    <div id="kuis-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 hidden">
        <div id="kuis-modal-content" class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl p-8 relative transform transition-all duration-300 scale-95 opacity-0">
             <div class="flex justify-between items-center mb-6">
                <!-- Score and Lives -->
                <div class="font-bold text-lg">Skor: <span id="kuis-score" class="text-indigo-600">0</span></div>
                <div class="flex items-center space-x-2">
                    <span class="font-bold text-lg">Nyawa:</span>
                    <div id="kuis-lives" class="flex space-x-1"></div>
                </div>
            </div>
            
            <!-- Timer Kuis -->
            <div id="kuis-timer-container" class="mb-4 text-center hidden">
                <p class="text-xl font-bold text-red-500">Waktu: <span id="quiz-timer">60</span></p>
            </div>
            
            <!-- Area Pertanyaan Kuis -->
            <div class="text-center">
                <!-- Soal Enkripsi/Dekripsi -->
                <div id="kuis-question-standard" class="hidden">
                    <p id="kuis-question-type-label" class="text-slate-500"></p>
                    <p id="kuis-question-text" class="text-3xl font-bold text-slate-800 tracking-widest my-2"></p>
                    <p class="text-slate-500">Dengan Kunci:</p>
                    <p id="kuis-question-key" class="text-3xl font-bold text-slate-800"></p>
                </div>
                <!-- Soal Analogi -->
                <div id="kuis-question-analogy" class="hidden bg-slate-50 p-4 rounded-lg">
                    <p class="text-slate-500">Jika:</p>
                    <p id="kuis-analogy-clue" class="text-2xl font-bold text-slate-800 tracking-wider"></p>
                    <p class="text-slate-500 mt-3">Maka:</p>
                    <p id="kuis-analogy-task" class="text-2xl font-bold text-slate-800 tracking-wider"></p>
                </div>

                <label for="kuis-input" class="block mt-6 mb-2 text-slate-600">Ketik jawabanmu di sini:</label>
                <input type="text" id="kuis-input" class="input-field mb-4">
                <div id="kuis-feedback" class="text-center font-bold mb-4 hidden h-6"></div>
                 <div class="flex items-center justify-center space-x-4 mt-6">
                     <button id="kuis-skip-btn" class="bg-slate-200 text-slate-700 font-bold py-3 px-6 rounded-lg hover:bg-slate-300 transition-colors">Lewati</button>
                    <button id="kuis-check-btn" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg text-lg hover:bg-green-700 transition-all w-40">Cek Jawaban</button>
                    <button id="kuis-next-btn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg text-lg hover:bg-indigo-700 transition-all w-40 hidden">Soal Berikutnya</button>
                </div>
            </div>
        </div>
        <!-- Game Over Screen (dalam modal) -->
        <div id="game-over-screen" class="bg-white rounded-2xl shadow-2xl w-full max-w-lg p-8 text-center hidden">
            <h2 class="text-4xl font-extrabold text-red-600 mb-4">Game Over</h2>
            <p class="text-slate-600 text-lg mb-6">Kesempatanmu sudah habis.</p>
            <p class="text-xl mb-8">Skor Akhir: <span id="final-score" class="font-bold text-3xl text-slate-800">0</span></p>
            <button id="play-again-btn" class="bg-indigo-600 text-white font-bold py-3 px-10 rounded-full text-lg hover:bg-indigo-700 transition-all">Main Lagi</button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tabs = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            const ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(item => item.classList.remove('active'));
                    tab.classList.add('active');
                    const target = tab.getAttribute('data-tab');
                    tabContents.forEach(content => {
                        content.id === target ? content.classList.add('active') : content
                            .classList.remove('active');
                    });
                });
            });

            // --- Konsep: Slider Visualisasi ---
            const slider = document.getElementById('key-slider');
            const sliderValue = document.getElementById('slider-value');
            const alphabetCipher = document.getElementById('alphabet-cipher');

            function updateAlphabetCipher(key) {
                let newAlphabet = '';
                for (let i = 0; i < ALPHABET.length; i++) {
                    const newIndex = (i + key) % 26;
                    newAlphabet += ALPHABET[newIndex] + ' ';
                }
                alphabetCipher.textContent = newAlphabet.trim();
                sliderValue.textContent = key;
            }

            slider.addEventListener('input', (e) => {
                updateAlphabetCipher(parseInt(e.target.value));
            });
            updateAlphabetCipher(3); // Initial value

            // --- Caesar Cipher Logic ---
            const caesarCipher = (text, key, mode) => {
                const shift = mode === 'encrypt' ? key : -key;
                let result = '';
                for (let char of text.toUpperCase()) {
                    if (ALPHABET.includes(char)) {
                        const base = ALPHABET.indexOf(char);
                        const newIndex = (base + shift + 26) % 26;
                        result += ALPHABET[newIndex];
                    } else {
                        result += char;
                    }
                }
                return result;
            };
            
             const findKey = (plaintext, ciphertext) => {
                if (!plaintext || !ciphertext || plaintext.length === 0) return 0;
                const pIndex = ALPHABET.indexOf(plaintext.toUpperCase()[0]);
                const cIndex = ALPHABET.indexOf(ciphertext.toUpperCase()[0]);
                return (cIndex - pIndex + 26) % 26;
            };

            // --- Contoh Soal Logic ---
            const pembahasanButtons = document.querySelectorAll('.toggle-pembahasan');
            pembahasanButtons.forEach((button, index) => {
                button.addEventListener('click', () => {
                    const container = button.nextElementSibling;
                    container.classList.toggle('hidden');
                    button.textContent = container.classList.contains('hidden') ? 'Tampilkan Pembahasan' : 'Sembunyikan Pembahasan';
                    
                    if (!container.classList.contains('hidden') && container.innerHTML === '') {
                        let html = '';
                        if(index === 0) { // Enkripsi
                            html = generatePembahasanHTML('KRIPTO', 5, 'encrypt');
                        } else if (index === 1) { // Dekripsi
                             html = generatePembahasanHTML('FUBSWH', 8, 'decrypt');
                        } else { // Cari Kunci
                            const key = findKey('SANDI', 'XERHM');
                            html = `<p class="mb-4">Untuk mencari kunci, kita cukup membandingkan posisi huruf pertama dari plaintext dan ciphertext.</p>
                                    <ul class="list-disc list-inside space-y-2">
                                        <li>Posisi huruf 'S' (plaintext) di alfabet adalah 18.</li>
                                        <li>Posisi huruf 'X' (ciphertext) di alfabet adalah 23.</li>
                                        <li>Selisihnya adalah: 23 - 18 = 5.</li>
                                    </ul>
                                    <p class="mt-4 font-bold">Jadi, kunci yang digunakan adalah 5.</p>`;
                        }
                        container.innerHTML = html;
                    }
                });
            });

            function generatePembahasanHTML(text, key, mode) {
                 const title = mode === 'encrypt' ? 'Enkripsi' : 'Dekripsi';
                 const textLabel = mode === 'encrypt' ? 'Plaintext' : 'Ciphertext';
                 const resultLabel = mode === 'encrypt' ? 'Ciphertext' : 'Plaintext';
                 let html = `<p class="mb-4">Proses ${title} dilakukan huruf demi huruf dengan menggeser posisinya di alfabet sesuai kunci.</p>
                             <div class="overflow-x-auto"><table class="w-full text-center border"><thead><tr class="bg-slate-100">
                             <th class="p-2 border">Huruf ${textLabel}</th><th class="p-2 border">Posisi Asli</th><th class="p-2 border">Pergeseran (Kunci)</th>
                             <th class="p-2 border">Posisi Baru</th><th class="p-2 border">Huruf ${resultLabel}</th></tr></thead><tbody>`;
                 
                 for(const char of text.toUpperCase()) {
                     const originalIndex = ALPHABET.indexOf(char);
                     const shift = mode === 'encrypt' ? key : -key;
                     const newIndex = (originalIndex + shift + 26) % 26;
                     const newChar = ALPHABET[newIndex];
                     const formula = mode === 'encrypt' ? `(${originalIndex} + ${key}) mod 26` : `(${originalIndex} - ${key} + 26) mod 26`;
                     
                     html += `<tr>
                                <td class="p-2 border font-bold">${char}</td>
                                <td class="p-2 border">${originalIndex}</td>
                                <td class="p-2 border">${shift > 0 ? '+' : ''}${shift}</td>
                                <td class="p-2 border">${newIndex} <span class="text-xs text-slate-500 block">${formula}</span></td>
                                <td class="p-2 border font-bold">${newChar}</td>
                              </tr>`;
                 }
                 html += `</tbody></table></div><p class="mt-4 font-bold">Hasil Akhir: ${caesarCipher(text, key, mode)}</p>`;
                 return html;
            }

            // --- Latihan Soal Logic ---
            const latihanModal = document.getElementById('latihan-modal');
            const latihanModalContent = document.getElementById('latihan-modal-content');
            const closeLatihanModalBtn = document.getElementById('close-latihan-modal');
            const latihanModeBtns = document.querySelectorAll('.latihan-mode-btn');
            const latihanTitle = document.getElementById('latihan-title');
            const latihanInput = document.getElementById('latihan-input');
            const latihanSubmitBtn = document.getElementById('latihan-submit-btn');
            const latihanNextBtn = document.getElementById('latihan-next-btn');
            const latihanSkipBtn = document.getElementById('latihan-skip-btn');
            const latihanFeedback = document.getElementById('latihan-feedback');
            const latihanContainers = [
                document.getElementById('latihan-question-encrypt'),
                document.getElementById('latihan-question-decrypt'),
                document.getElementById('latihan-question-find-key')
            ];
            
            const words = ['GEMA', 'MALAM', 'SIANG', 'KATA', 'KERJA', 'CINTA', 'BAIK', 'AKSES', 'KUNCI', 'BUDAYA', 'TEMA', 'KREATIF', 'SENI', 'ALGORITMA', 'PRODUK', 'DESAIN', 'ANALISIS', 'KODE', 'LOGIKA'];
            let currentLatihanMode = '';
            let currentLatihanAnswer = '';

            latihanModeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    currentLatihanMode = btn.dataset.mode;
                    generateLatihanQuestion();
                    latihanTitle.textContent = btn.textContent;
                    latihanModal.classList.remove('hidden');
                    setTimeout(() => {
                        latihanModalContent.classList.remove('scale-95', 'opacity-0');
                        latihanInput.focus();
                    }, 10);
                });
            });
            
            closeLatihanModalBtn.addEventListener('click', () => {
                 latihanModalContent.classList.add('scale-95', 'opacity-0');
                 setTimeout(() => latihanModal.classList.add('hidden'), 300);
            });
            
            function generateLatihanQuestion(){
                latihanInput.value = '';
                latihanInput.disabled = false;
                latihanFeedback.classList.add('hidden');
                latihanSubmitBtn.classList.remove('hidden');
                latihanNextBtn.classList.add('hidden');
                latihanSkipBtn.classList.remove('hidden');
                
                const randomWord = words[Math.floor(Math.random() * words.length)];
                const randomKey = Math.floor(Math.random() * 25) + 1;

                latihanContainers.forEach(c => c.classList.add('hidden'));

                if(currentLatihanMode === 'encrypt') {
                    document.getElementById('latihan-encrypt-plaintext').textContent = randomWord;
                    document.getElementById('latihan-encrypt-key').textContent = randomKey;
                    currentLatihanAnswer = caesarCipher(randomWord, randomKey, 'encrypt');
                    latihanContainers[0].classList.remove('hidden');
                } else if(currentLatihanMode === 'decrypt') {
                    const ciphertext = caesarCipher(randomWord, randomKey, 'encrypt');
                    document.getElementById('latihan-decrypt-ciphertext').textContent = ciphertext;
                    document.getElementById('latihan-decrypt-key').textContent = randomKey;
                    currentLatihanAnswer = randomWord;
                    latihanContainers[1].classList.remove('hidden');
                } else if(currentLatihanMode === 'find-key') {
                    const ciphertext = caesarCipher(randomWord, randomKey, 'encrypt');
                    document.getElementById('latihan-find-key-plaintext').textContent = randomWord;
                    document.getElementById('latihan-find-key-ciphertext').textContent = ciphertext;
                    currentLatihanAnswer = randomKey.toString();
                    latihanContainers[2].classList.remove('hidden');
                }
            }
            
            function checkLatihanAnswer() {
                 const userAnswer = latihanInput.value.trim().toUpperCase();
                 latihanInput.disabled = true;

                 if(userAnswer === currentLatihanAnswer) {
                     latihanFeedback.textContent = 'Benar!';
                     latihanFeedback.className = 'text-center font-bold mb-4 h-6 text-green-600';
                 } else {
                     latihanFeedback.textContent = `Salah! Jawaban: ${currentLatihanAnswer}`;
                     latihanFeedback.className = 'text-center font-bold mb-4 h-6 text-red-600';
                 }
                 latihanFeedback.classList.remove('hidden');
                 latihanSubmitBtn.classList.add('hidden');
                 latihanNextBtn.classList.remove('hidden');
                 latihanSkipBtn.classList.add('hidden');
            }

            latihanSubmitBtn.addEventListener('click', checkLatihanAnswer);
            latihanInput.addEventListener('keydown', e => {
                if(e.key === 'Enter' && !latihanSubmitBtn.classList.contains('hidden')) checkLatihanAnswer();
            });
            latihanNextBtn.addEventListener('click', generateLatihanQuestion);
            latihanSkipBtn.addEventListener('click', generateLatihanQuestion);


            // --- Kuis Gamifikasi Logic ---
            const kuisModal = document.getElementById('kuis-modal');
            const kuisModalContent = document.getElementById('kuis-modal-content');
            const startQuizBtn = document.getElementById('start-quiz-btn');
            const highscoreDisplay = document.getElementById('highscore-display');
            const scoreDisplay = document.getElementById('kuis-score');
            const livesDisplay = document.getElementById('kuis-lives');
            const kuisInput = document.getElementById('kuis-input');
            const kuisCheckBtn = document.getElementById('kuis-check-btn');
            const kuisNextBtn = document.getElementById('kuis-next-btn');
            const kuisSkipBtn = document.getElementById('kuis-skip-btn');
            const kuisFeedback = document.getElementById('kuis-feedback');
            const gameOverScreen = document.getElementById('game-over-screen');
            const finalScoreDisplay = document.getElementById('final-score');
            const playAgainBtn = document.getElementById('play-again-btn');
            const quizAnalogyWords = [
                {q: "INFORMATIKA", a: "KOMPUTER"}, {q: "INDONESIA", a: "PANCASILA"}, {q: "JAKARTA", a: "BANDUNG"},
                {q: "MERAH", a: "PUTIH"}, {q: "KIRI", a: "KANAN"}, {q: "PRESIDEN", a: "MENTERI"}, {q: "BUKU", a: "PENSIL"},
                {q: "MATAHARI", a: "BULAN"}, {q: "LANGIT", a: "BUMI"}, {q: "MEJA", a: "KURSI"}, {q: "MUSIK", a: "LAGU"},
                {q: "SEKOLAH", a: "KAMPUS"}, {q: "GURU", a: "DOSEN"}, {q: "PAGI", a: "MALAM"}, {q: "PANAS", a: "DINGIN"},
                {q: "AIR", a: "API"}, {q: "HUTAN", a: "GUNUNG"}, {q: "PULAU", a: "LAUTAN"}, {q: "MANUSIA", a: "HEWAN"},
                {q: "PESAWAT", a: "KAPAL"}, {q: "SENIN", a: "SELASA"}, {q: "JANUARI", a: "FEBRUARI"}, {q: "Kucing", a: "Anjing"},
                {q: "Emas", a: "Perak"}, {q: "Berlian", a: "Intan"}, {q: "Kopi", a: "Teh"}, {q: "Mobil", a: "Motor"},
                {q: "Rumah", a: "Apartemen"}, {q: "Laptop", a: "Tablet"}, {q: "Ponsel", a: "Smartphone"},
                {q: "Keyboard", a: "Mouse"}, {q: "Monitor", a: "Layar"}, {q: "Kamera", a: "Lensa"}, {q: "Film", a: "Video"},
                {q: "Novel", a: "Cerpen"}, {q: "Puisi", a: "Sajak"}, {q: "Lukisan", a: "Patung"}, {q: "Gitar", a: "Piano"},
                {q: "Biola", a: "Cello"}, {q: "Sepakbola", a: "Basket"}, {q: "Voli", a: "Tenis"},
                {q: "Dokter", a: "Perawat"}, {q: "Polisi", a: "Tentara"}, {q: "Pilot", a: "Pramugari"},
                {q: "Programmer", a: "Desainer"}, {q: "Penulis", a: "Editor"}, {q: "Aktor", a: "Aktris"},
                {q: "Sutradara", a: "Produser"}, {q: "Ilmuwan", a: "Peneliti"}
            ];


            let score = 0, lives = 3, highscore = 0;
            let currentQuizAnswer = '';
            let quizQuestionCounter = 0;
            let quizTimerInterval = null;
            const QUIZ_TIMER_DURATION = 60;
            
            function initQuiz() {
                highscore = localStorage.getItem('caesarCipherHighscore') || 0;
                highscoreDisplay.textContent = highscore;
            }

            startQuizBtn.addEventListener('click', () => {
                score = 0;
                lives = 3;
                quizQuestionCounter = 0;
                kuisModal.classList.remove('hidden');
                setTimeout(() => {
                    kuisModalContent.classList.remove('scale-95', 'opacity-0');
                    kuisInput.focus();
                }, 10);
                gameOverScreen.classList.add('hidden');
                kuisModalContent.classList.remove('hidden');
                generateQuizQuestion();
            });
            
            playAgainBtn.addEventListener('click', () => {
                score = 0;
                lives = 3;
                quizQuestionCounter = 0;
                gameOverScreen.classList.add('hidden');
                kuisModalContent.classList.remove('hidden');
                generateQuizQuestion();
            });

            function updateQuizUI() {
                scoreDisplay.textContent = score;
                livesDisplay.innerHTML = '';
                for (let i = 0; i < 3; i++) {
                    const heartIcon = document.createElement('span');
                    heartIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" /></svg>`;
                    heartIcon.classList.add(i < lives ? 'text-red-500' : 'text-slate-300');
                    livesDisplay.appendChild(heartIcon);
                }
            }
            
            function startTimer() {
                const timerDisplay = document.getElementById('quiz-timer');
                document.getElementById('kuis-timer-container').classList.remove('hidden');
                let timeLeft = QUIZ_TIMER_DURATION;
                timerDisplay.textContent = timeLeft;

                quizTimerInterval = setInterval(() => {
                    timeLeft--;
                    timerDisplay.textContent = timeLeft;
                    if (timeLeft <= 0) {
                        clearInterval(quizTimerInterval);
                        handleWrongAnswer(true); // Waktu Habis
                    }
                }, 1000);
            }

            function stopTimer() {
                clearInterval(quizTimerInterval);
                document.getElementById('kuis-timer-container').classList.add('hidden');
            }

            function generateQuizQuestion() {
                kuisInput.value = '';
                kuisInput.disabled = false;
                kuisFeedback.classList.add('hidden');
                kuisCheckBtn.classList.remove('hidden');
                kuisNextBtn.classList.add('hidden');
                kuisSkipBtn.classList.remove('hidden');
                updateQuizUI();
                stopTimer();
                
                const questionType = quizQuestionCounter % 3;
                const randomKey = Math.floor(Math.random() * 25) + 1;
                
                document.getElementById('kuis-question-standard').classList.add('hidden');
                document.getElementById('kuis-question-analogy').classList.add('hidden');

                if (questionType === 0) { // Enkripsi
                    const randomWord = words[Math.floor(Math.random() * words.length)];
                    document.getElementById('kuis-question-type-label').textContent = 'Enkripsi Plaintext Berikut:';
                    document.getElementById('kuis-question-text').textContent = randomWord;
                    document.getElementById('kuis-question-key').textContent = randomKey;
                    currentQuizAnswer = caesarCipher(randomWord, randomKey, 'encrypt');
                    document.getElementById('kuis-question-standard').classList.remove('hidden');
                } else if (questionType === 1) { // Dekripsi
                    const randomWord = words[Math.floor(Math.random() * words.length)];
                    const ciphertext = caesarCipher(randomWord, randomKey, 'encrypt');
                    document.getElementById('kuis-question-type-label').textContent = 'Dekripsi Ciphertext Berikut:';
                    document.getElementById('kuis-question-text').textContent = ciphertext;
                    document.getElementById('kuis-question-key').textContent = randomKey;
                    currentQuizAnswer = randomWord;
                    document.getElementById('kuis-question-standard').classList.remove('hidden');
                } else { // Analogi
                    const pair = quizAnalogyWords[Math.floor(Math.random() * quizAnalogyWords.length)];
                    const cluePlaintext = pair.q.toUpperCase();
                    const taskPlaintext = pair.a.toUpperCase();
                    const clueCiphertext = caesarCipher(cluePlaintext, randomKey, 'encrypt');
                    const taskCiphertext = caesarCipher(taskPlaintext, randomKey, 'encrypt');
                    
                    document.getElementById('kuis-analogy-clue').textContent = `${cluePlaintext} -> ${clueCiphertext}`;
                    document.getElementById('kuis-analogy-task').textContent = `[ ??? ] -> ${taskCiphertext}`;
                    currentQuizAnswer = taskPlaintext;
                    document.getElementById('kuis-question-analogy').classList.remove('hidden');
                }
                
                if((quizQuestionCounter + 1) % 4 === 3) {
                     startTimer();
                }

                quizQuestionCounter++;
                kuisInput.focus();
            }

            function handleCorrectAnswer() {
                 stopTimer();
                 score += 100;
                 kuisFeedback.textContent = 'Benar!';
                 kuisFeedback.className = 'text-center font-bold mb-4 h-6 text-green-600';
                 kuisFeedback.classList.remove('hidden');
                 kuisInput.disabled = true;
                 kuisCheckBtn.classList.add('hidden');
                 kuisNextBtn.classList.remove('hidden');
                 kuisSkipBtn.classList.add('hidden');
            }
            
            function handleWrongAnswer(isTimeout = false) {
                 stopTimer();
                 lives--;
                 kuisFeedback.textContent = isTimeout ? `Waktu Habis! Jawaban: ${currentQuizAnswer}` : `Salah! Jawaban: ${currentQuizAnswer}`;
                 kuisFeedback.className = 'text-center font-bold mb-4 h-6 text-red-600';
                 kuisFeedback.classList.remove('hidden');
                 kuisInput.disabled = true;
                 kuisCheckBtn.classList.add('hidden');
                 kuisSkipBtn.classList.add('hidden');
                 
                 updateQuizUI();

                 if (lives > 0) {
                     kuisNextBtn.classList.remove('hidden');
                 } else {
                     setTimeout(triggerGameOver, 2000);
                 }
            }

            function triggerGameOver() {
                if (score > highscore) {
                    highscore = score;
                    localStorage.setItem('caesarCipherHighscore', highscore);
                    highscoreDisplay.textContent = highscore;
                }
                finalScoreDisplay.textContent = score;
                kuisModalContent.classList.add('hidden');
                gameOverScreen.classList.remove('hidden');
            }

            kuisCheckBtn.addEventListener('click', () => {
                const userAnswer = kuisInput.value.trim().toUpperCase();
                if (userAnswer === currentQuizAnswer) {
                   handleCorrectAnswer();
                } else {
                   handleWrongAnswer();
                }
            });

            kuisNextBtn.addEventListener('click', () => {
                 if(lives > 0) generateQuizQuestion();
            });

            kuisInput.addEventListener('keydown', e => {
                if(e.key === 'Enter' && !kuisCheckBtn.classList.contains('hidden')) kuisCheckBtn.click();
            });
            
             kuisSkipBtn.addEventListener('click', () => {
                 stopTimer();
                 kuisInput.disabled = true;
                 lives--;
                 kuisFeedback.textContent = `Soal dilewati! Jawaban: ${currentQuizAnswer}`;
                 kuisFeedback.className = 'text-center font-bold mb-4 h-6 text-orange-600';
                 kuisFeedback.classList.remove('hidden');
                 kuisCheckBtn.classList.add('hidden');
                 kuisSkipBtn.classList.add('hidden');

                 updateQuizUI();
                 if (lives > 0) {
                     kuisNextBtn.classList.remove('hidden');
                 } else {
                     setTimeout(triggerGameOver, 2000);
                 }
            });
            
            initQuiz();
        });
    </script>
</body>

</html>

